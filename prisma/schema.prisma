generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

/// Raça
model Raca {
  id          Int          @id @default(autoincrement())
  nome        String
  descricao   String?
  hp          Int?         @default(0)
  mana        Int?         @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  personagens Personagem[]
}

/// Classe
model Classe {
  id                Int      @id @default(autoincrement())
  slug              String?  @unique // <-- opcional agora
  nome              String
  subtitulo         String?
  descricao         String?
  gameplay          String?
  background        String?
  img_corpo         String?
  exemploPersonagem String?
  tags              Json?
  hp                Int?     @default(0)
  mana              Int?     @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  personagens Personagem[]
  Magias      MagiaCatalog[] @relation("ClasseMagias")
}

/// Campanha
model Campanha {
  id              Int          @id @default(autoincrement())
  nome            String
  sinopse         String?
  capa            String?
  count_jogadores Int?
  mestre          String?
  tags            Json?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  personagens     Personagem[]
}

/// Personagem
model Personagem {
  id                Int                 @id @default(autoincrement())
  nome              String
  apelido           String?
  descricao         String?
  campanhaId        Int
  classeId          Int
  racaId            Int
  elemento          String
  hp_atual          Int?
  mana_atual        Int?
  hp_base           Int?
  mana_base         Int?
  imagem_pixel      String?
  url_imagem        String?
  status_baile      String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  baileId           Int?
  inventarios       Inventorio[]
  magiaPersonagem   MagiaPersonagem[]
  periciaPersonagem PericiaPersonagem[]
  baile             Baile?              @relation(fields: [baileId], references: [id])
  campanha          Campanha            @relation(fields: [campanhaId], references: [id])
  classe            Classe              @relation(fields: [classeId], references: [id])
  raca              Raca                @relation(fields: [racaId], references: [id])

  @@index([campanhaId])
  @@index([racaId])
  @@index([classeId])
}

/// Catálogo de Magias
model MagiaCatalog {
  id          Int     @id @default(autoincrement())
  nome        String
  alcance     String?
  descricao   String?
  custo_nivel Int?
  classeId    Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  classe      Classe?           @relation("ClasseMagias", fields: [classeId], references: [id])
  personagens MagiaPersonagem[]

  @@unique([nome, classeId])
  @@index([classeId])
}

/// Vínculo Magia <-> Personagem
model MagiaPersonagem {
  id           Int          @id @default(autoincrement())
  personagemId Int
  magiaId      Int
  custo_nivel  Int?
  descricao    String?
  createdAt    DateTime     @default(now())
  magia        MagiaCatalog @relation(fields: [magiaId], references: [id])
  personagem   Personagem   @relation(fields: [personagemId], references: [id])

  @@index([personagemId])
  @@index([magiaId])
}

/// Catálogo de Perícias
model PericiaCatalog {
  id          Int                 @id @default(autoincrement())
  nome        String
  tipo        String              @default("")
  descricao   String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  personagens PericiaPersonagem[]

  @@unique([nome, tipo])
}

/// Vínculo Perícia <-> Personagem
model PericiaPersonagem {
  id           Int            @id @default(autoincrement())
  personagemId Int
  periciaId    Int
  pontuacao    Int
  descricao    String?
  createdAt    DateTime       @default(now())
  pericia      PericiaCatalog @relation(fields: [periciaId], references: [id])
  personagem   Personagem     @relation(fields: [personagemId], references: [id])

  @@index([personagemId])
  @@index([periciaId])
}

/// Inventório de Personagem (opcional)
model Inventorio {
  id           Int        @id @default(autoincrement())
  personagemId Int
  nome         String
  tipo         String?
  descricao    String?
  icon         String?
  createdAt    DateTime   @default(now())
  personagem   Personagem @relation(fields: [personagemId], references: [id])

  @@index([personagemId])
}

model Baile {
  id          Int               @id @default(autoincrement())
  nome        String
  descricao   String?
  meta        Json?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  roleActions BaileRoleAction[]
  personagens Personagem[]
}

model BaileRoleAction {
  id        Int      @id @default(autoincrement())
  baileId   Int
  tipo      String
  acoes     Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  baile     Baile    @relation(fields: [baileId], references: [id], onDelete: Cascade)

  @@index([baileId, tipo])
}
